<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>WebAI Builder Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #eff6ff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; font-family: 'Inter', sans-serif; }
        .main-container { flex: 1; display: flex; padding: 20px; gap: 20px; }
        .sidebar { width: 400px; background: white; border-radius: 20px; padding: 30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .preview-area { flex: 1; background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.05); position: relative; }
        textarea { flex: 1; border: 1px solid #d1d5db; border-radius: 12px; padding: 15px; margin-bottom: 20px; font-size: 15px; transition: border 0.3s; }
        textarea:focus { border-color: #3b82f6; outline: none; }
        iframe { width: 100%; height: 100%; border: none; }
        .btn-gen { background: #2563eb; color: white; border: none; padding: 12px; border-radius: 12px; font-weight: 600; }
        .btn-gen:hover { background: #1d4ed8; }
        .loading { position: absolute; inset: 0; background: rgba(255,255,255,0.85); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="sidebar">
        <h3 class="fw-bold text-primary mb-1">AI WebGen</h3>
        <p class="text-muted small mb-4">Tulis alur web, sistem akan menginstalnya untuk Anda.</p>
        
        <form action="/" method="POST" id="formGen" class="d-flex flex-column h-100">
            <label class="fw-medium mb-2 text-dark">Deskripsi Algoritma:</label>
            <textarea name="prompt" placeholder="Contoh: Buat sistem login. Jika sukses tampilkan grafik stok barang dari dataframe acak." required></textarea>
            <button type="submit" class="btn-gen mb-2">Bangun Web Sekarang âœ¨</button>
            <button type="button" id="btnStop" class="btn btn-light text-danger btn-sm fw-bold">Hentikan Sesi</button>
        </form>
    </div>

    <div class="preview-area">
        <div id="loader" class="loading">
            <div class="spinner-grow text-primary mb-3"></div>
            <p class="fw-bold">Sedang Merakit Kode...</p>
        </div>
        <iframe src="http://localhost:8501" id="framePreview"></iframe>
    </div>
</div>

<script>
    const form = document.getElementById('formGen');
    const loader = document.getElementById('loader');
    const iframe = document.getElementById('framePreview');

    form.onsubmit = () => { loader.style.display = 'flex'; };

    document.getElementById('btnStop').onclick = async () => {
        if(confirm("Matikan aplikasi?")) {
            await fetch('/stop', { method: 'POST' });
            iframe.src = iframe.src;
        }
    };

    {% if success %}
        setTimeout(() => { 
            iframe.src = iframe.src;
            loader.style.display = 'none';
        }, 1000);
    {% endif %}
</script>

</body>
</html>
