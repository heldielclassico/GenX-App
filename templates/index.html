<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Sivita Style Web Builder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        .main-container { flex: 1; display: flex; padding: 20px; gap: 20px; }
        .sidebar { width: 400px; background: white; border-radius: 15px; padding: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .preview-pane { flex: 1; background: white; border-radius: 15px; overflow: hidden; position: relative; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 300px; border-radius: 10px; border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; resize: none; }
        iframe { width: 100%; height: 100%; border: none; }
        .loader-overlay { position: absolute; inset: 0; background: rgba(255,255,255,0.9); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 20; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="sidebar">
            <h4 class="fw-bold">ðŸŽ“ AI Web Designer</h4>
            <p class="text-muted small">Tulis alur algoritma, sistem akan menggenerate kode & langsung running.</p>
            <form action="/" method="POST" id="genForm">
                <textarea name="prompt" placeholder="Contoh: Buat web asisten virtual poltesa dengan loader 5 detik, form input email, dan fitur tanya jawab pakai AI." required></textarea>
                <button type="submit" class="btn btn-primary w-100 fw-bold">Generate & Launch ðŸš€</button>
            </form>
            <button onclick="stopApp()" class="btn btn-outline-danger btn-sm w-100 mt-2">Stop Session ðŸ›‘</button>
        </div>
        <div class="preview-pane">
            <div id="loading" class="loader-overlay">
                <div class="spinner"></div>
                <p class="mt-3 fw-bold">Sedang Menyiapkan Server Streamlit...</p>
            </div>
            <iframe src="http://localhost:8501" id="preview-frame"></iframe>
        </div>
    </div>

    <script>
        const form = document.getElementById('genForm');
        const loader = document.getElementById('loading');
        const iframe = document.getElementById('preview-frame');

        form.onsubmit = () => { loader.style.display = 'flex'; };

        async function stopApp() {
            if(confirm("Hentikan server?")) {
                await fetch('/stop', { method: 'POST' });
                iframe.src = iframe.src;
            }
        }

        {% if success %}
            setTimeout(() => { 
                iframe.src = iframe.src; 
                loader.style.display = 'none';
            }, 500);
        {% endif %}
    </script>
</body>
</html>
